### 一、 HTTP/HTTPS

##### 1. 请求行



##### 2. 请求头

- User-Agent：Mozilla/xxx
  + Mozilla：起初是为了区分是否能显示图片的请求头
- Method：GET/POST/PUT/DELETE
- Date：服务器发送时间
- Server：服务器类型



### 二、浏览器渲染

![浏览器渲染流程](.\图\浏览器渲染流程.jpg)

##### 1. 输入域名发送请求：

- 构建请求：
  - 请求行：`GET URI HTTP1.0 200`
  - 请求头：`user-agent: Mozilla/5.0` 等
  - 请求体：如 `post` 请求常用于携带参数


- 查找缓存：DNS缓存和资源缓存


- DNS解析：
  - 过程：查找浏览器缓存 -> 查找操作系统缓存 -> 查找hosts文件是否有对应映射 ->  本地域名服务器查找 -> 顶级域名服务器查找 (引导去二级域名服务器查找) -> 二级域名服务器查找(引导去三级域名服务器查找) -> 三级域名服务器查找(引导去下级服务器查找) -> 继续往下级查找直至返回映射关系
  - 递归：前三步查找时，有则直接返回映射关系，否则去其他域名服务器查找
  - 迭代：后续去顶级域名服务器等查找，如果能查找到则直接返回映射关系，否则告诉其去下级域名服务器查找或报错
- 建立连接
- 发送HTTP请求
- 服务器处理请求
- 服务器响应请求：
  - 响应行：`HTTP1.0 200`
  - 响应头：
    - set-cookie
    - keep-alive
    - cache-control
  - 响应体
- 断开TCP连接
- 浏览器渲染：
  - 构建DOM Tree
  - 生成styleSheet
  - 将样式标准化
  - 添加每个节点的具体 样式
  - `DOM Tree` 和 `CSSOM` 并行构建，互不影响，最终结合生成Render Tree(layout tree)
  - 由于 `layout tree` 需要 `DOM Tree` 和 `CSSOM` 结合才能生成，因此 `CSSOM` 会阻塞页面渲染
  - 遇到 `JS` 脚本时，由于`  JS` 可能会对DOM或者样式进行操作，因此`JS` 脚本会被阻塞直到 `CSSOM` 构建完成才能执行，而当执行 `JS` 脚本执行时，会停止 `DOM Tree` 的构建，因此在该种情况下 `CSSOM` 变相阻塞了 `DOM Tree` 的构建
  - `JS` 执行时会阻止 `Render Tree` 的构建，因为JS引擎和GUI引擎是互斥的

##### 2. JavaScript引擎解析响应报文：

- `BLink` 会将 `JS` 代码转换为 `Stream(流)`


- 通过词法分析（扫描器 `scanner` ）将 `Stream` 代码转化为 `tokens` 
  - 利用 `parse` 模块将 `tokens` 代码转换为 `AST树 `（进行词法分析和语法分析），未使用的函数进行 `preParse(预解析)` 
- 利用 `ignition` 模块将 `AST树` 转换为 `字节码`
- 由于不同环境下CPU的构造不同，对应的机器码也不同，因此不能直接转换为机器码
- 为了提高效率， 利用 `TurboFan` 模块对字节码进行转换，并标记函数是否为 `hot` (重复使用的函数，便于缓存)，使其更接近与对应环境的字节码
- 将优化后的字节码转换为机器码并由CPU执行

##### 3. 

### 三、宏观下的浏览器

1. 进程内有多个线程
2. 线程之间共享同一个进程内的数据
3. 任一线程执行出错会导致进程崩溃
4. 进程直接的内容相互隔离，可以通过ipc进行通信
5. 进程被关闭后，所有资源都会被回收
6. 进程分为渲染进程，gpu进程，插件进程，浏览器进程和网络进程五种
7. 同一站点用同一个渲染进程
8. 渲染进程内有五个线程：JS线程、定时触发器线程、事件触发器线程、HTTP异步请求线程和GUI线程
9. 多进程浏览器可以使用安全沙箱（降低进程的权限，不能访问系统重要文件和资源），更加稳定，页面奔溃不会导致浏览器崩溃


